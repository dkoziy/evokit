containers:

  frontend:
    environ:
      NODE_PATH: /usr/lib/node_modules
      PROJECT_DEPS: /usr/lib
    setup:
    - !Alpine v3.8
    - !Install [nodejs-npm]
    - !EnsureDir /work/node_modules
    - !EnsureDir /usr/lib/node_modules/.cache
    - !NpmDependencies
      package: true
      dev: true
    volumes:
      /work/node_modules: !Empty

commands:

  build_es6: !Command
    description: Run build
    container: frontend
    options: |
      Usage:
        vagga build_es6 [--watch|-w]

      Options:
        --watch, -w          enable webpack watch
    run: |
      webpack --progress ${VAGGACLI_WATCH} --config webpack.es6.config.js

  build: !Command
    description: Run build
    container: frontend
    environ:
      NODE_ENV: production
    run: |
      gulp compile_uikit

  watch: !Command
    description: Run watch *.styl
    container: frontend
    run: |
      gulp watch
