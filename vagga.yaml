containers:

  frontend:
    environ:
      NODE_PATH: /usr/lib/node_modules
      PROJECT_DEPS: /usr/lib
      NODE_ENV: production
    setup:
    - !Alpine v3.7
    - !Install [nodejs-npm]
    # - !EnsureDir /work/node_modules
    - !EnsureDir /usr/lib/node_modules/.cache
    - !NpmDependencies
      package: true
      dev: true
    # volumes:
    #   /work/node_modules: !Empty

commands:

  build_es: !Command
    description: Run build
    container: frontend
    options: |
      Usage:
        vagga build_es [--watch|-w]

      Options:
        --watch, -w          enable webpack watch
    run: |
      webpack --progress ${VAGGACLI_WATCH} --config webpack.config.js

  build: !Command
    description: Run build
    container: frontend
    run: |
      gulp compile_uikit
      webpack --progress --config webpack.config.js

  watch: !Command
    description: Run watch *.styl
    container: frontend
    run: |
      gulp watch
